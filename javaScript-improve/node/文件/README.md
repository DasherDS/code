### 文件流

- 什么是流
  - 流是指数据的流动，数据从一个地方缓缓的流动到另一个地方
  - 流是有方向的
    - 可读流：Readable  数据从源头流向内存
    - 可写流：Writable 数据从内存流向源头
    - 双工流：Duplex  数据既可以从源头流向内存又可以从内存流向源头
- 为什么需要流
  - 其他的介质和内存的数据规模不一致
  - 其他介质和内存的数据处理能力不一致
- 文件流
  - 什么是文件流
    - 内存数据和磁盘文件数据之间的流动
  - 文件流的创建
    - `fs.createReadStream(path[, optinos])`
      - 含义：创建一个文件可读流，用于读取文件内容
      - `path`：读取的文件路径
      - `options`：可选配置
        - `encoding`：编码方式
        - `start`：起始字节
        - `end`：结束字节
        - `highWaterMark`：每次读取数量
          - 如果`encoding`有值，该数量表示一个字符数
          - 如果`encoding`为`null`，该数量表示字节数
      - 返回：`Readable`的子类`ReadStream`
        - 事件：`rs.on(事件名, 处理函数)`
          - `open`
            - 文件打开事件
            - 文件被打开后触发
          - `error`
            - 文件出错后会触发
          - `close`
            - 文件被关闭后触发
            - 可通过`rs.close`手动关闭
            - 或文件读取完成后自动关闭
          - `data`
            - 读取到一部分数据后触发
            - 注册`data`事件后，才会真正开始读取
            - 每次读取`highWaterMark`指定的数量
            - 回调函数中会附带读取到的数据
              - 
          - `end`
            - 全部读取完毕触发
        - `rs.pause()` ：暂停读取，会触发`pause`事件
        - `rs.resume()`：回复读取，会触发`resume`事件
    - `fs.createWriteStream(path[, options])`
      - 创建一个写入流
      - `path`：写入的文件路径
      - `options`
        - `flags`：操作文件的方式
        - `encoding`：编码方式
        - `start`：起始字节
        - `highWaterMark`：每次最多写入的字节数
      - 返回：`Writeable`的子类`WriteStream`
        - `ws.on(事件名, 处理函数)`
          - `open`
          - `error`
          - `close`
        - `ws.write(data)`
          - 写入一组数据
          - `data`可以是字符串或者`Buffer`
          - 返回一个`boolean`值
            - `true`：写入通道没有被填满，接下来的数据可以直接写入，无需排队
            - `false`：写入通道目前已被填满，接下来的数据将进入写入队列
              - 要特别注意背压问题，因为写入队列是内存中的数据，是有限的
          - 当写入队列清空时，会触发`drain`事件
        - `ws.end([data])`
          - 结束写入，将自动关闭文件
          - `data`是可选的，表示关闭前的最后一次写入
    - `rs.pipe(ws)`
      - 将可读流连接到可写流
      - 返回参数的值
      - 该方法可解决背压问题